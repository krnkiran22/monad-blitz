import{P as A}from"./phaser-CaWnzXme.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class L extends Phaser.Scene{constructor(){super("GameScene")}init(){this.JUMP=15,this.JUMP_SPEED=6,this.GRAVITY=.5,this.MAX_BAMBOO=20,this.MAX_ENEMIES=20,this.MAX_LEAVES=50,this.MAX_FIRE=20,this.MAX_PARTICLES=32,this.SNAKE_SPAWN_CHANCE=15,this.DINGO_SPAWN_CHANCE=15,this.FIRE_SPAWN_CHANCE=20,this.SEASON_DURATION=1200,this.seasons=["SPRING","SUMMER","FALL","WINTER"],this.currentSeason=0,this.seasonTimer=0,this.seasonsCompleted=0,this.clockRotation=0,this.state="GRABED",this.velocity=0,this.jumpSpeed=0,this.grabCounter=10,this.score=0,this.currentLeaves=0,this.highScore=parseInt(localStorage.getItem("koalaHighScore")||"0"),this.speed=4,this.playerActive=!0,this.bambooTimer=0,this.bambooSpawnTime=50,this.killer="fire",this.popupScores=[],this.scrollFront=0,this.scrollMiddle=0,this.scrollBack=0,this.scrollSpeed=1.6,this.musicPlaying=!1}preload(){this.load.image("atlas01","assets/atlas01.png"),this.load.image("atlas02","assets/atlas02.png"),this.load.audio("jump","assets/jump.ogg"),this.load.audio("eat_leaves","assets/eat_leaves.ogg"),this.load.audio("dash","assets/dash.ogg"),this.load.audio("dingo_die","assets/dingo_die.ogg"),this.load.audio("snake_die","assets/snake_die.ogg")}create(){this.cameras.main.setBounds(0,-200,1280,920),this.createSpritesFromAtlases(),this.createBackground(),this.createGround(),this.sounds={jump:this.sound.add("jump",{volume:.3,loop:!1}),eat:this.sound.add("eat_leaves",{volume:.3,loop:!1}),dash:this.sound.add("dash",{volume:.3,loop:!1}),dingoDie:this.sound.add("dingo_die",{volume:.4,loop:!1}),snakeDie:this.sound.add("snake_die",{volume:.4,loop:!1})},this.bambooData=[],this.bambooActive=[],this.bambooSprites=[],this.enemyData=[],this.enemyActive=[],this.enemyType=[],this.enemySprites=[],this.leafData=[],this.leafActive=[],this.leafSide=[],this.leafSprites=[],this.fireData=[],this.fireActive=[],this.fireSprites=[],this.fireOnFire=[],this.burntTreeSprites=[],this.fireFlameSprites=[],this.particles=[];for(let t=0;t<this.MAX_PARTICLES;t++)this.particles.push({sprite:null,x:0,y:0,speed:0,active:!1});for(let t=0;t<this.MAX_BAMBOO;t++)this.bambooData[t]={x:0,y:0,width:50,height:720},this.bambooActive[t]=!1,this.bambooSprites[t]=null;for(let t=0;t<this.MAX_ENEMIES;t++)this.enemyData[t]={x:0,y:0,width:50,height:60},this.enemyActive[t]=!1,this.enemyType[t]="snake",this.enemySprites[t]=null;for(let t=0;t<this.MAX_LEAVES;t++)this.leafData[t]={x:0,y:0,width:30,height:30},this.leafActive[t]=!1,this.leafSide[t]=!1,this.leafSprites[t]=null;for(let t=0;t<this.MAX_FIRE;t++)this.fireData[t]={x:0,y:690,width:30,height:128},this.fireActive[t]=!1,this.fireSprites[t]=null,this.fireOnFire[t]=!1,this.burntTreeSprites[t]=null,this.fireFlameSprites[t]=[];this.playerBounds={x:200,y:400,width:35,height:60},this.koalaSprite=this.add.sprite(this.playerBounds.x,this.playerBounds.y,"koala_idle"),this.koalaSprite.setOrigin(0,0),this.koalaSprite.setScale(1.2),this.koalaSprite.setDepth(10);for(let t=0;t<6;t++)this.bambooData[t].x=150+200*t,this.bambooData[t].y=0,this.bambooActive[t]=!0,this.bambooSprites[t]=this.add.image(this.bambooData[t].x,this.bambooData[t].y,"bamboo"),this.bambooSprites[t].setOrigin(0,0),this.bambooSprites[t].setDepth(1),this.spawnLeavesOnBamboo(t);this.createUI(),this.updateSeasonVisuals(),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.fireAnimFrame=0,this.fireAnimTimer=0}createSpritesFromAtlases(){const t=this.textures.get("atlas01").getSourceImage(),e=this.textures.get("atlas02").getSourceImage(),s=document.createElement("canvas");s.width=100,s.height=100,s.getContext("2d").drawImage(t,1025,384,100,100,0,0,100,100),this.textures.addCanvas("koala_idle",s);const a=document.createElement("canvas");a.width=100,a.height=100,a.getContext("2d").drawImage(t,1083,1732,100,100,0,0,100,100),this.textures.addCanvas("koala_jump",a);const o=document.createElement("canvas");o.width=43,o.height=720,o.getContext("2d").drawImage(e,1788,2,43,720,0,0,43,720),this.textures.addCanvas("bamboo",o);const d=document.createElement("canvas");d.width=64,d.height=64,d.getContext("2d").drawImage(t,1857,166,64,64,0,0,64,64),this.textures.addCanvas("leaf",d);const p=document.createElement("canvas");p.width=80,p.height=150,p.getContext("2d").drawImage(t,755,1079,80,150,0,0,80,150),this.textures.addCanvas("dingo",p);const m=document.createElement("canvas");m.width=120,m.height=128,m.getContext("2d").drawImage(t,1025,254,120,128,0,0,120,128),this.textures.addCanvas("snake",m);for(let l=0;l<4;l++){const h=document.createElement("canvas");h.width=64,h.height=128,h.getContext("2d").drawImage(t,516+l*64,930,64,128,0,0,64,128),this.textures.addCanvas(`fire_${l}`,h)}const u=document.createElement("canvas");u.width=43,u.height=720,u.getContext("2d").drawImage(t,58,1028,43,720,0,0,43,720),this.textures.addCanvas("burnt_tree",u);const y=document.createElement("canvas");y.width=151,y.height=150,y.getContext("2d").drawImage(t,772,1265,151,150,0,0,151,150),this.textures.addCanvas("clock_base",y);const x=document.createElement("canvas");x.width=300,x.height=303,x.getContext("2d").drawImage(t,103,1423,300,303,0,0,300,303),this.textures.addCanvas("clock_disc",x);const S=document.createElement("canvas");S.width=178,S.height=175,S.getContext("2d").drawImage(t,626,1520,178,175,0,0,178,175),this.textures.addCanvas("leaf_counter_base",S);const b=document.createElement("canvas");b.width=32,b.height=32,b.getContext("2d").drawImage(e,276,766,32,32,0,0,32,32),this.textures.addCanvas("particle_ice",b);const _=document.createElement("canvas");_.width=32,_.height=32,_.getContext("2d").drawImage(e,808,315,32,32,0,0,32,32),this.textures.addCanvas("particle_flower",_);const C=document.createElement("canvas");C.width=32,C.height=32,C.getContext("2d").drawImage(e,538,715,32,32,0,0,32,32),this.textures.addCanvas("particle_planetree",C),["spring","summer","fall","winter"].forEach((l,h)=>{const c=document.createElement("canvas");c.width=640,c.height=77,c.getContext("2d").drawImage(e,1146,2+h*79,640,77,0,0,640,77),this.textures.addCanvas(`ground_${l}`,c)});const v=document.createElement("canvas");v.width=640,v.height=360,v.getContext("2d").drawImage(e,2,2,640,360,0,0,640,360),this.textures.addCanvas("background",v);const T=[{x:1833,y:353,w:28,h:335},{x:690,y:315,w:26,h:332},{x:2028,y:338,w:15,h:329},{x:1860,y:2,w:38,h:334},{x:504,y:364,w:32,h:349},{x:1980,y:2,w:31,h:334},{x:606,y:364,w:25,h:349},{x:1896,y:338,w:32,h:331}],M=[{x:1998,y:338,w:28,h:335},{x:718,y:315,w:26,h:332},{x:774,y:315,w:15,h:329},{x:1900,y:2,w:38,h:334},{x:538,y:364,w:32,h:349},{x:2013,y:2,w:31,h:334},{x:633,y:364,w:25,h:349},{x:1930,y:338,w:32,h:331}],O=[{x:660,y:315,w:28,h:335},{x:746,y:315,w:26,h:332},{x:791,y:315,w:15,h:329},{x:1940,y:2,w:38,h:334},{x:572,y:364,w:32,h:349},{x:1863,y:338,w:31,h:334},{x:1833,y:2,w:25,h:349},{x:1964,y:338,w:32,h:331}];for(let l=0;l<8;l++){const h=T[l],c=document.createElement("canvas");c.width=h.w,c.height=h.h,c.getContext("2d").drawImage(e,h.x,h.y,h.w,h.h,0,0,h.w,h.h),this.textures.addCanvas(`tree0${l+1}_layer1`,c);const f=M[l],k=document.createElement("canvas");k.width=f.w,k.height=f.h,k.getContext("2d").drawImage(e,f.x,f.y,f.w,f.h,0,0,f.w,f.h),this.textures.addCanvas(`tree0${l+1}_layer2`,k);const g=O[l],w=document.createElement("canvas");w.width=g.w,w.height=g.h,w.getContext("2d").drawImage(e,g.x,g.y,g.w,g.h,0,0,g.w,g.h),this.textures.addCanvas(`tree0${l+1}_layer3`,w)}const I=[{x:1146,y:2,w:640,h:77},{x:1146,y:81,w:640,h:77},{x:1146,y:160,w:640,h:77},{x:1146,y:239,w:640,h:77}];for(let l=0;l<4;l++){const h=I[l],c=document.createElement("canvas");c.width=h.w,c.height=h.h,c.getContext("2d").drawImage(e,h.x,h.y,h.w,h.h,0,0,h.w,h.h),this.textures.addCanvas(`ground_layer${l}`,c)}}createBackground(){this.bgSprites=[];for(let s=0;s<3;s++){const i=this.add.image(s*640,0,"background");i.setOrigin(0,0),i.setScale(2),i.setDepth(-10),this.bgSprites.push(i)}this.treesLayer3=[],this.groundLayer3=[];const t=Phaser.Math.Between(10,100);for(let s=0;s<4;s++)for(let i=0;i<8;i++){const a=s*1280+t+140*i,r=this.add.image(a,67,`tree0${i+1}_layer3`);r.setOrigin(0,0),r.setScale(2),r.setDepth(-6),this.treesLayer3.push(r);const o=this.add.image(a,-10,"ground_layer3");o.setOrigin(0,0),o.setScale(2),o.setDepth(-5),this.treesLayer3.push(o);const n=this.add.image(a,144,"ground_layer3");n.setOrigin(0,1),n.setScale(2,-2),n.setDepth(-5),this.treesLayer3.push(n)}for(let s=0;s<4;s++){const i=this.add.image(s*1280,469,"ground_layer3");i.setOrigin(0,0),i.setScale(2),i.setDepth(-6),this.groundLayer3.push(i)}this.treesLayer2=[],this.groundLayer2=[];for(let s=0;s<4;s++)for(let i=0;i<8;i++){const a=s*1280+140*i,r=this.add.image(a,67,`tree0${i+1}_layer2`);r.setOrigin(0,0),r.setScale(2),r.setDepth(-4),this.treesLayer2.push(r);const o=this.add.image(a,-10,"ground_layer2");o.setOrigin(0,0),o.setScale(2),o.setDepth(-3),this.treesLayer2.push(o);const n=this.add.image(a,144,"ground_layer2");n.setOrigin(0,1),n.setScale(2,-2),n.setDepth(-3),this.treesLayer2.push(n)}for(let s=0;s<4;s++){const i=this.add.image(s*1280,509,"ground_layer2");i.setOrigin(0,0),i.setScale(2),i.setDepth(-4),this.groundLayer2.push(i)}this.treesLayer1=[],this.groundLayer1=[];const e=Phaser.Math.Between(100,200);for(let s=0;s<4;s++)for(let i=0;i<8;i++){const a=s*1280+e+140*i,r=i===2||i===5?55:60,o=this.add.image(a,r,`tree0${i+1}_layer1`);o.setOrigin(0,0),o.setScale(2),o.setDepth(-2),this.treesLayer1.push(o);const n=this.add.image(a,-10,"ground_layer1");n.setOrigin(0,0),n.setScale(2),n.setDepth(-1),this.treesLayer1.push(n);const d=this.add.image(a,144,"ground_layer1");d.setOrigin(0,1),d.setScale(2,-2),d.setDepth(-1),this.treesLayer1.push(d)}for(let s=0;s<4;s++){const i=this.add.image(s*1280,559,"ground_layer1");i.setOrigin(0,0),i.setScale(2),i.setDepth(-2),this.groundLayer1.push(i)}}createGround(){this.groundSprites=[];for(let t=0;t<5;t++){const e=this.add.image(t*640,643,"ground_spring");e.setOrigin(0,0),e.setDepth(5),this.groundSprites.push(e)}}updateParallax(){this.scrollFront-=this.scrollSpeed,this.scrollMiddle-=this.scrollSpeed*.75,this.scrollBack-=this.scrollSpeed*.5,this.scrollFront<=-5120&&(this.scrollFront+=5120),this.scrollMiddle<=-5120&&(this.scrollMiddle+=5120),this.scrollBack<=-5120&&(this.scrollBack+=5120),this.treesLayer1.forEach((t,e)=>{const s=Math.floor(e/3),i=Math.floor(s/8),a=s%8,r=i*1280+150+140*a;t.x=r+this.scrollFront,t.x<-640&&(t.x+=5120)}),this.treesLayer2.forEach((t,e)=>{const s=Math.floor(e/3),i=Math.floor(s/8),a=s%8,r=i*1280+140*a;t.x=r+this.scrollMiddle,t.x<-640&&(t.x+=5120)}),this.treesLayer3.forEach((t,e)=>{const s=Math.floor(e/3),i=Math.floor(s/8),a=s%8,r=i*1280+50+140*a;t.x=r+this.scrollBack,t.x<-640&&(t.x+=5120)}),this.groundLayer1.forEach((t,e)=>{t.x=e*1280+this.scrollFront,t.x<-1280&&(t.x+=5120)}),this.groundLayer2.forEach((t,e)=>{t.x=e*1280+this.scrollMiddle,t.x<-1280&&(t.x+=5120)}),this.groundLayer3.forEach((t,e)=>{t.x=e*1280+this.scrollBack,t.x<-1280&&(t.x+=5120)})}createUI(){const t=this.add.circle(90,60,55,0,.7);t.setStrokeStyle(4,4863784),t.setScrollFactor(0).setDepth(99),this.scoreText=this.add.text(90,60,"0",{fontSize:"40px",fill:"#ffffff",stroke:"#000000",strokeThickness:6,fontStyle:"bold",fontFamily:"Arial"}).setOrigin(.5).setScrollFactor(0).setDepth(100),this.leafCounterBase=this.add.image(90,160,"leaf_counter_base"),this.leafCounterBase.setScale(.55),this.leafCounterBase.setScrollFactor(0).setDepth(99),this.leafText=this.add.text(90,160,"0",{fontSize:"36px",fill:"#ffffff",stroke:"#000000",strokeThickness:6,fontStyle:"bold",fontFamily:"Arial"}).setOrigin(.5).setScrollFactor(0).setDepth(100),this.seasonClock=this.add.image(1190,90,"clock_disc"),this.seasonClock.setScale(.45),this.seasonClock.setScrollFactor(0).setDepth(100),this.seasonClockBase=this.add.image(1190,90,"clock_base"),this.seasonClockBase.setScale(.5),this.seasonClockBase.setScrollFactor(0).setDepth(101),this.seasonText=this.add.text(1190,165,"SPRING",{fontSize:"26px",fill:"#81c784",stroke:"#000000",strokeThickness:6,fontStyle:"bold",fontFamily:"Arial"}).setOrigin(.5).setScrollFactor(0).setDepth(100)}spawnLeavesOnBamboo(t){const e=Math.floor(Math.random()*3);for(let s=0;s<e;s++)for(let i=0;i<this.MAX_LEAVES;i++)if(!this.leafActive[i]){const a=Math.floor(Math.random()*5);this.leafSide[i]=Math.random()>.5,this.leafData[i].x=this.leafSide[i]?this.bambooData[t].x+18:this.bambooData[t].x-18,this.leafData[i].y=30+720/5*a,this.leafActive[i]=!0,this.leafSprites[i]=this.add.image(this.leafData[i].x-25,this.leafData[i].y-15,"leaf"),this.leafSprites[i].setOrigin(0,0),this.leafSprites[i].setScale(1),this.leafSprites[i].setDepth(2);break}}update(){if(!this.playerActive)return;this.updateParallax();for(let e=0;e<this.MAX_BAMBOO;e++)this.bambooActive[e]&&(this.bambooData[e].x-=this.speed,this.bambooSprites[e]&&(this.bambooSprites[e].x=this.bambooData[e].x),this.bambooData[e].x<-100&&(this.bambooActive[e]=!1,this.bambooSprites[e]&&(this.bambooSprites[e].destroy(),this.bambooSprites[e]=null)));for(let e=0;e<this.MAX_LEAVES;e++)if(this.leafActive[e]){let s=!1;for(let i=0;i<this.MAX_BAMBOO;i++)if(this.bambooActive[i]){const a=this.leafSide[e]?this.bambooData[i].x+18:this.bambooData[i].x-18;if(Math.abs(this.leafData[e].x-a)<50){this.leafData[e].x=a,s=!0;break}}this.leafSprites[e]&&(this.leafSprites[e].x=this.leafData[e].x-25),(!s||this.leafData[e].x<-100)&&(this.leafActive[e]=!1,this.leafSprites[e]&&(this.leafSprites[e].destroy(),this.leafSprites[e]=null))}for(let e=0;e<this.MAX_ENEMIES;e++)if(this.enemyActive[e]){let s=!1;for(let i=0;i<this.MAX_BAMBOO;i++)if(this.bambooActive[i]){const a=this.bambooData[i].x-15;if(Math.abs(this.enemyData[e].x-a)<50){this.enemyData[e].x=a,s=!0;break}}this.enemySprites[e]&&(this.enemyType[e]==="dingo"?(this.enemySprites[e].x=this.enemyData[e].x-this.enemyData[e].width/2,this.enemySprites[e].y=this.enemyData[e].y-this.enemyData[e].height/4):(this.enemySprites[e].x=this.enemyData[e].x-this.enemyData[e].width,this.enemySprites[e].y=this.enemyData[e].y-this.enemyData[e].height/2)),(!s||this.enemyData[e].x<=-this.enemyData[e].width)&&(this.enemyActive[e]=!1,this.enemySprites[e]&&(this.enemySprites[e].destroy(),this.enemySprites[e]=null))}for(let e=0;e<this.MAX_FIRE;e++)if(this.fireActive[e]){let s=!1;for(let a=0;a<this.MAX_BAMBOO;a++)if(this.bambooActive[a]){const r=this.bambooData[a].x-5;if(Math.abs(this.fireData[e].x-r)<50){this.fireData[e].x=r,s=!0;break}}if(this.fireData[e].x<=this.playerBounds.x+this.playerBounds.width&&!this.fireOnFire[e]&&(this.fireOnFire[e]=!0,this.burntTreeSprites[e]&&(this.burntTreeSprites[e].setVisible(!0),this.burntTreeSprites[e].x=this.fireData[e].x+5)),this.fireOnFire[e]&&this.fireData[e].y>-50&&(this.fireData[e].y-=2),this.fireSprites[e]&&(this.fireSprites[e].x=this.fireData[e].x,this.fireSprites[e].y=this.fireData[e].y),this.burntTreeSprites[e]&&this.fireOnFire[e]){this.burntTreeSprites[e].x=this.fireData[e].x+5;const a=720-this.fireData[e].y;this.burntTreeSprites[e].setCrop(0,Math.max(0,720-a),43,a)}const i=5;for(let a=0;a<20;a++)this.fireFlameSprites[e][a]&&(this.fireData[e].y-25<=a*43&&this.fireOnFire[e]?(this.fireFlameSprites[e][a].setVisible(!0),a%2>0?this.fireFlameSprites[e][a].x=this.fireData[e].x+i-10:this.fireFlameSprites[e][a].x=this.fireData[e].x-i,this.fireFlameSprites[e][a].y=40*a):this.fireFlameSprites[e][a].setVisible(!1));if((!s||this.fireData[e].x<-100)&&(this.fireActive[e]=!1,this.fireOnFire[e]=!1,this.fireSprites[e]&&(this.fireSprites[e].destroy(),this.fireSprites[e]=null),this.burntTreeSprites[e]&&(this.burntTreeSprites[e].destroy(),this.burntTreeSprites[e]=null),this.fireFlameSprites[e])){for(let a=0;a<this.fireFlameSprites[e].length;a++)this.fireFlameSprites[e][a]&&this.fireFlameSprites[e][a].destroy();this.fireFlameSprites[e]=[]}}if(this.fireAnimTimer++,this.fireAnimTimer>=10){this.fireAnimFrame=(this.fireAnimFrame+1)%4,this.fireAnimTimer=0;for(let e=0;e<this.MAX_FIRE;e++)if(this.fireActive[e]&&this.fireSprites[e]&&this.fireSprites[e].setTexture(`fire_${this.fireAnimFrame}`),this.fireFlameSprites[e]){for(let s=0;s<this.fireFlameSprites[e].length;s++)if(this.fireFlameSprites[e][s]&&this.fireFlameSprites[e][s].visible){const i=(this.fireAnimFrame+s%3)%4;this.fireFlameSprites[e][s].setTexture(`fire_${i}`)}}}this.updateSeasonalParticles();for(let e=this.popupScores.length-1;e>=0;e--){const s=this.popupScores[e];s.alpha-=.02,s.y-=3,s.text.setAlpha(s.alpha),s.text.setPosition(s.x,s.y),s.alpha<=0&&(s.text.destroy(),this.popupScores.splice(e,1))}this.bambooTimer++,this.bambooTimer>=this.bambooSpawnTime&&(this.spawnBamboo(),this.bambooTimer=0,this.bambooSpawnTime=35+Math.floor(Math.random()*51)),this.seasonTimer++,this.seasonTimer>=this.SEASON_DURATION&&(this.seasonTimer=0,this.currentSeason=(this.currentSeason+1)%4,this.currentSeason===0&&this.seasonsCompleted++,this.updateSeasonVisuals());const t=this.seasonTimer/this.SEASON_DURATION;this.clockRotation=t*90+this.currentSeason*90,this.seasonClock.setAngle(this.clockRotation),this.updatePlayer(),this.score+=.1,this.scoreText.setText(Math.floor(this.score).toString()),this.leafText.setText(this.currentLeaves.toString()),this.playerBounds.y>800&&this.gameOver()}updateSeasonalParticles(){const t=this.seasons[this.currentSeason];if(Math.random()<.08){for(let e=0;e<this.MAX_PARTICLES;e++)if(!this.particles[e].active){this.particles[e].x=Math.random()*1280,this.particles[e].y=-20,this.particles[e].speed=1+Math.random()*2,this.particles[e].active=!0;let s;if(t==="WINTER")s="particle_ice";else if(t==="SPRING")s="particle_flower";else if(t==="FALL")s="particle_planetree";else continue;this.particles[e].sprite&&this.particles[e].sprite.destroy(),this.particles[e].sprite=this.add.image(this.particles[e].x,this.particles[e].y,s),this.particles[e].sprite.setScale(.5+Math.random()*.5),this.particles[e].sprite.setDepth(0);break}}for(let e=0;e<this.MAX_PARTICLES;e++)this.particles[e].active&&(this.particles[e].y+=this.particles[e].speed,this.particles[e].x-=this.speed*.5,this.particles[e].sprite&&(this.particles[e].sprite.x=this.particles[e].x,this.particles[e].sprite.y=this.particles[e].y,this.particles[e].sprite.setAngle(this.particles[e].sprite.angle+2)),(this.particles[e].y>720||this.particles[e].x<-50)&&(this.particles[e].active=!1,this.particles[e].sprite&&(this.particles[e].sprite.destroy(),this.particles[e].sprite=null)))}updateSeasonVisuals(){const t=this.seasons[this.currentSeason],e={SPRING:"#81c784",SUMMER:"#fdd835",FALL:"#ff9800",WINTER:"#64b5f6"};this.seasonText.setText(t),this.seasonText.setColor(e[t]);const s=`ground_${t.toLowerCase()}`;this.groundSprites.forEach(n=>{n.setTexture(s)});const i=this.getSeasonColors(t),a=Phaser.Display.Color.GetColor(i.color02.r,i.color02.g,i.color02.b);this.bgSprites.forEach(n=>{n.setTint(a)});const r=Phaser.Display.Color.GetColor(i.color02.r,i.color02.g,i.color02.b);this.treesLayer1&&this.treesLayer1.forEach(n=>n.setTint(r)),this.treesLayer2&&this.treesLayer2.forEach(n=>n.setTint(r)),this.treesLayer3&&this.treesLayer3.forEach(n=>n.setTint(r));const o=Phaser.Display.Color.GetColor(i.color01.r,i.color01.g,i.color01.b);this.groundLayer1&&this.groundLayer1.forEach(n=>n.setTint(o)),this.groundLayer2&&this.groundLayer2.forEach(n=>n.setTint(o)),this.groundLayer3&&this.groundLayer3.forEach(n=>n.setTint(o)),this.cameras.main.flash(1e3)}getSeasonColors(t){const e={SPRING:{color00:{r:196,g:176,b:49},color01:{r:178,g:163,b:67},color02:{r:133,g:143,b:90},color03:{r:133,g:156,b:42}},SUMMER:{color00:{r:129,g:172,b:86},color01:{r:145,g:165,b:125},color02:{r:161,g:130,b:73},color03:{r:198,g:103,b:51}},FALL:{color00:{r:242,g:113,b:62},color01:{r:190,g:135,b:114},color02:{r:144,g:130,b:101},color03:{r:214,g:133,b:58}},WINTER:{color00:{r:130,g:130,b:181},color01:{r:145,g:145,b:166},color02:{r:104,g:142,b:144},color03:{r:57,g:140,b:173}}};return e[t]||e.SPRING}updatePlayer(){switch(this.state){case"GRABED":this.grabCounter++,this.koalaSprite.setTexture("koala_idle");for(let t=0;t<this.MAX_BAMBOO;t++)if(this.bambooActive[t]&&this.checkCollision(this.playerBounds,this.bambooData[t])){this.playerBounds.x=this.bambooData[t].x-15,this.playerBounds.y<520&&(this.playerBounds.y+=1);break}Phaser.Input.Keyboard.JustDown(this.spaceKey)&&(this.state="JUMPING",this.velocity=this.JUMP,this.jumpSpeed=this.JUMP_SPEED,this.grabCounter=0,this.sounds.jump.isPlaying||this.sounds.jump.play());break;case"JUMPING":this.koalaSprite.setTexture("koala_jump"),this.playerBounds.x+=this.jumpSpeed,this.velocity-=this.GRAVITY,this.playerBounds.y-=this.velocity,this.playerBounds.y<50&&(this.playerBounds.y=50,this.velocity=0);for(let t=0;t<this.MAX_BAMBOO;t++)this.bambooActive[t]&&this.grabCounter>=10&&this.checkCollision(this.playerBounds,this.bambooData[t])&&(this.state="GRABED",this.playerBounds.x=this.bambooData[t].x-15,this.velocity=0,this.jumpSpeed=0);this.grabCounter++;break}if(this.koalaSprite.x=this.playerBounds.x-this.playerBounds.width,this.koalaSprite.y=this.playerBounds.y-25,this.playerBounds.x<=-this.playerBounds.width){this.killer="offscreen",this.gameOver();return}for(let t=0;t<this.MAX_LEAVES;t++)if(this.leafActive[t]&&this.checkCollision(this.playerBounds,this.leafData[t])){this.leafActive[t]=!1,this.leafSprites[t]&&(this.leafSprites[t].destroy(),this.leafSprites[t]=null),this.currentLeaves++,this.score+=10,this.sounds.eat.isPlaying||this.sounds.eat.play();const e=this.add.text(this.leafData[t].x,this.leafData[t].y,"+1",{fontSize:"32px",fill:"#8BB300",stroke:"#000",strokeThickness:5,fontStyle:"bold"}).setDepth(50);this.popupScores.push({text:e,x:this.leafData[t].x,y:this.leafData[t].y,alpha:1})}for(let t=0;t<this.MAX_ENEMIES;t++)if(this.enemyActive[t]&&this.checkCollision(this.playerBounds,this.enemyData[t])){this.killer=this.enemyType[t],this.killer==="dingo"&&!this.sounds.dingoDie.isPlaying?this.sounds.dingoDie.play():this.killer==="snake"&&!this.sounds.snakeDie.isPlaying&&this.sounds.snakeDie.play(),this.gameOver();return}for(let t=0;t<this.MAX_FIRE;t++)if(this.fireActive[t]&&this.checkCollision(this.playerBounds,this.fireData[t])){this.killer="fire",this.gameOver();return}}spawnBamboo(){for(let t=0;t<this.MAX_BAMBOO;t++)if(!this.bambooActive[t]){this.bambooData[t].x=1280,this.bambooData[t].y=0,this.bambooActive[t]=!0,this.bambooSprites[t]=this.add.image(this.bambooData[t].x,this.bambooData[t].y,"bamboo"),this.bambooSprites[t].setOrigin(0,0),this.bambooSprites[t].setDepth(1),this.spawnLeavesOnBamboo(t);const e=this.seasons[this.currentSeason];e==="SPRING"?Math.random()*100<=this.DINGO_SPAWN_CHANCE&&this.spawnEnemy("dingo",t):(e==="SUMMER"||e==="FALL")&&(Math.random()*100<=this.SNAKE_SPAWN_CHANCE&&this.spawnEnemy("snake",t),e==="SUMMER"&&Math.random()*100<=this.FIRE_SPAWN_CHANCE&&this.spawnFire(t));break}}spawnEnemy(t,e){for(let s=0;s<this.MAX_ENEMIES;s++)if(!this.enemyActive[s]){this.enemyType[s]=t;let i;t==="dingo"?(i=Math.floor(Math.random()*3)+1,this.enemyData[s].width=64,this.enemyData[s].height=90):(i=Math.floor(Math.random()*5),this.enemyData[s].width=50,this.enemyData[s].height=60),this.enemyData[s].x=1265,this.enemyData[s].y=25+720/5*i,this.enemyActive[s]=!0;const a=t==="dingo"?-32:-50,r=t==="dingo"?-22:-30,o=t==="dingo"?1:.9;this.enemySprites[s]=this.add.image(this.enemyData[s].x+a,this.enemyData[s].y+r,t),this.enemySprites[s].setOrigin(0,0),this.enemySprites[s].setScale(o),this.enemySprites[s].setDepth(2);break}}spawnFire(t){for(let e=0;e<this.MAX_FIRE;e++)if(!this.fireActive[e]){this.fireData[e].x=1275,this.fireData[e].y=690,this.fireActive[e]=!0,this.fireOnFire[e]=!1,this.fireSprites[e]=this.add.image(this.fireData[e].x,562,`fire_${this.fireAnimFrame}`),this.fireSprites[e].setOrigin(0,0),this.fireSprites[e].setScale(.7),this.fireSprites[e].setDepth(2),this.fireFlameSprites[e]=[];for(let s=0;s<20;s++){const i=this.add.image(0,0,`fire_${this.fireAnimFrame}`);i.setOrigin(0,0),i.setScale(.5),i.setDepth(2),i.setVisible(!1),this.fireFlameSprites[e].push(i)}this.burntTreeSprites[e]=this.add.image(this.fireData[e].x+5,0,"burnt_tree"),this.burntTreeSprites[e].setOrigin(0,0),this.burntTreeSprites[e].setDepth(1),this.burntTreeSprites[e].setVisible(!1);break}}checkCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}gameOver(){this.playerActive=!1,this.sound.stopAll(),this.score>this.highScore&&(this.highScore=Math.floor(this.score),localStorage.setItem("koalaHighScore",this.highScore.toString())),this.scene.start("GameOverScene",{score:Math.floor(this.score),leaves:this.currentLeaves,seasons:this.seasonsCompleted,highScore:this.highScore,killer:this.killer,clockRotation:this.clockRotation})}}class B extends Phaser.Scene{constructor(){super("MenuScene")}preload(){this.load.image("atlas01","assets/atlas01.png"),this.load.image("atlas02","assets/atlas02.png")}create(){this.createSpritesFromAtlases();const t=this.add.image(0,0,"background");t.setOrigin(0,0),t.setScale(2);const e=this.add.image(0,643,"ground_spring");e.setOrigin(0,0),e.setScale(2),this.add.image(640,250,"title_logo").setScale(1.2);const i=this.add.text(640,500,"PRESS SPACE TO START",{fontSize:"42px",fill:"#ffffff",stroke:"#000000",strokeThickness:8,fontStyle:"bold"});i.setOrigin(.5),this.tweens.add({targets:i,alpha:.3,duration:800,yoyo:!0,repeat:-1});const a=parseInt(localStorage.getItem("koalaHighScore")||"0");this.add.text(640,580,`HIGH SCORE: ${a}`,{fontSize:"28px",fill:"#ffd700",stroke:"#000000",strokeThickness:6}).setOrigin(.5),this.add.text(640,650,"SPACE - Jump | â†“ - Dash",{fontSize:"24px",fill:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE)}createSpritesFromAtlases(){const t=this.textures.get("atlas01").getSourceImage(),e=this.textures.get("atlas02").getSourceImage(),s=document.createElement("canvas");s.width=512,s.height=348,s.getContext("2d").drawImage(t,2,678,512,348,0,0,512,348),this.textures.addCanvas("title_logo",s);const a=document.createElement("canvas");a.width=640,a.height=360,a.getContext("2d").drawImage(e,2,2,640,360,0,0,640,360),this.textures.addCanvas("background",a);const o=document.createElement("canvas");o.width=640,o.height=77,o.getContext("2d").drawImage(e,1146,2,640,77,0,0,640,77),this.textures.addCanvas("ground_spring",o)}update(){Phaser.Input.Keyboard.JustDown(this.spaceKey)&&this.scene.start("GameScene")}}class F extends Phaser.Scene{constructor(){super("GameOverScene")}init(t){this.finalScore=t.score||0,this.seasons=t.seasons||0,this.leavesCollected=t.leaves||0,this.killCount=t.kills||0,this.killer=t.killer||0,this.killHistory=t.killHistory||[],this.initSeason=t.initSeason||0,this.currentSeason=t.currentSeason||0,this.initYear=t.initYear||2025}create(){this.cameras.main.setBackgroundColor("#b0a797"),this.framesCounter=-10,this.endingState="DELAY",this.currentScore=0,this.seasonsCounter=0,this.currentLeavesEnding=0,this.framesKillsCounter=0,this.activeKills=[];const t=[225,135,45,315];this.initRotation=t[this.initSeason],this.clockRotation=this.initRotation;const e=Math.floor(this.seasons/4);this.finalRotation=t[this.currentSeason]+360*e;const s=["SUMMER","AUTUMN","WINTER","SPRING"];this.initMonthText=s[this.initSeason],this.finalMonthText=s[this.currentSeason],this.finalYears=this.initYear+e,this.extractSprites(),this.createUI(),this.createLeafParticles()}extractSprites(){const t=this.textures.get("atlas01").getSourceImage(),e=this.textures.get("atlas02").getSourceImage(),s={x:260,y:1028,w:256,h:256};if(!this.textures.exists("ending_background")){const a=document.createElement("canvas");a.width=s.w,a.height=s.h,a.getContext("2d").drawImage(e,s.x,s.y,s.w,s.h,0,0,s.w,s.h),this.textures.addCanvas("ending_background",a)}const i={ending_button_replay:{x:974,y:1403,w:123,h:123},ending_button_share:{x:954,y:1528,w:123,h:123},ending_button_shop:{x:958,y:1653,w:123,h:123},ending_button_trophy:{x:1479,y:386,w:123,h:123},ending_plate_frame:{x:2,y:2,w:1052,h:250},ending_paint_back:{x:765,y:254,w:258,h:305},ending_paint_frame:{x:103,y:1028,w:334,h:393},ending_paint_koalafire:{x:771,y:643,w:219,h:216},ending_paint_koalasnake:{x:774,y:861,w:219,h:216},ending_paint_koaladingo:{x:439,y:1278,w:219,h:216},ending_paint_koalaowl:{x:661,y:1790,w:100,h:81},ending_paint_koalageneric:{x:516,y:678,w:253,h:250},ending_paint_koalabee:{x:439,y:1060,w:219,h:216},ending_paint_koalaeagle:{x:405,y:1496,w:219,h:216},ending_score_frame:{x:419,y:1714,w:119,h:123},ending_score_frameback:{x:540,y:1714,w:119,h:123},ending_score_seasonicon:{x:925,y:1265,w:135,h:136},ending_score_seasonneedle:{x:2032,y:2,w:12,h:45},ending_score_leavesicon:{x:1387,y:254,w:135,h:130},ending_score_enemyicon:{x:661,y:1697,w:113,h:91},ending_score_planksmall:{x:1583,y:116,w:389,h:48},ending_score_planklarge:{x:1056,y:132,w:525,h:48},ending_plate_headsnake:{x:65,y:1968,w:46,h:67},ending_plate_headdingo:{x:1481,y:182,w:56,h:70},ending_plate_headowl:{x:226,y:1885,w:68,h:52},ending_plate_headbee:{x:1318,y:516,w:62,h:60},ending_plate_headeagle:{x:1974,y:116,w:39,h:48},particle_ecualyptusleaf:{x:1989,y:200,w:32,h:32}};for(const[a,r]of Object.entries(i))if(!this.textures.exists(a)){const o=document.createElement("canvas");o.width=r.w,o.height=r.h,o.getContext("2d").drawImage(t,r.x,r.y,r.w,r.h,0,0,r.w,r.h),this.textures.addCanvas(a,o)}}createUI(){for(let o=0;o<3;o++)for(let n=0;n<5;n++)this.add.image(n*256,o*256,"ending_background").setOrigin(0,0);this.add.image(1280*.042,720*.606,"ending_plate_frame").setOrigin(0,0),this.add.image(1280*.133,720*.097,"ending_paint_back").setOrigin(0,0);const s={fire:{key:"ending_paint_koalafire",x:1280*.145,y:720*.171},snake:{key:"ending_paint_koalasnake",x:1280*.145,y:720*.171},dingo:{key:"ending_paint_koaladingo",x:1280*.145,y:720*.171},owl:{key:"ending_paint_koalaowl",x:1280*.2,y:720*.3},natural:{key:"ending_paint_koalageneric",x:1280*.133,y:720*.171},bee:{key:"ending_paint_koalabee",x:1280*.145,y:720*.171},eagle:{key:"ending_paint_koalaeagle",x:1280*.145,y:720*.171},offscreen:{key:"ending_paint_koalageneric",x:1280*.133,y:720*.171}},i=s[this.killer]||s.natural;this.add.image(i.x,i.y,i.key).setOrigin(0,0),this.add.image(1280*.102,720*.035,"ending_paint_frame").setOrigin(0,0),this.add.image(1280*.521,720*.163,"ending_score_planksmall").setOrigin(0,0),this.add.image(1280*.415,720*.303,"ending_score_planklarge").setOrigin(0,0),this.add.image(1280*.521,720*.44,"ending_score_planksmall").setOrigin(0,0),this.add.image(1280*.529,720*.096,"ending_score_seasonicon").setOrigin(0,0),this.seasonNeedle=this.add.image(1280*.579+6,720*.189+6,"ending_score_seasonneedle"),this.seasonNeedle.setOrigin(.5,.9),this.seasonNeedle.setAngle(this.clockRotation),this.add.image(1280*.535,720*.11,"ending_score_frame").setOrigin(0,0),this.add.image(1280*.43,720*.246,"ending_score_frameback").setOrigin(0,0),this.add.image(1280*.429,720*.244,"ending_score_frame").setOrigin(0,0),this.add.image(1280*.421,720*.228,"ending_score_leavesicon").setOrigin(0,0),this.add.image(1280*.536,720*.383,"ending_score_frameback").setOrigin(0,0),this.add.image(1280*.535,720*.383,"ending_score_frame").setOrigin(0,0),this.add.image(1280*.538,720*.414,"ending_score_enemyicon").setOrigin(0,0),this.replayButton=this.add.image(1280*.871,720*.096,"ending_button_replay").setOrigin(0,0).setInteractive(),this.replayButton.on("pointerdown",()=>this.replay()),this.replayButton.on("pointerover",()=>this.replayButton.setTint(16766720)),this.replayButton.on("pointerout",()=>this.replayButton.clearTint()),this.add.image(1280*.871,720*.303,"ending_button_shop").setOrigin(0,0),this.add.image(1280*.871,720*.513,"ending_button_trophy").setOrigin(0,0),this.add.image(1280*.871,720*.719,"ending_button_share").setOrigin(0,0),this.seasonsText=this.add.text(1280*.73,720*.14,"000",{fontSize:"48px",fill:"#fff",fontFamily:"Arial",fontStyle:"bold"}),this.leavesText=this.add.text(1280*.73,720*.29,"000",{fontSize:"48px",fill:"#fff",fontFamily:"Arial",fontStyle:"bold"}),this.scoreText=this.add.text(1280*.715,720*.426,"0000",{fontSize:"48px",fill:"#fff",fontFamily:"Arial",fontStyle:"bold"}),this.add.text(1280*.1,720*.7,`${this.initMonthText} ${this.initYear} - ${this.finalMonthText} ${this.finalYears}`,{fontSize:"24px",fill:"#fff",fontFamily:"Arial"});const a={fire:["Kissed by fire"],snake:["Digested alive by a","big snake"],dingo:["A dingo took your life"],owl:["Turned into a pretty","owl pellet"],natural:["LIFE KILLED YOU"],bee:["You turn out to be","allergic to bee sting"],eagle:["KOALA IS DEAD :("],offscreen:["Fell off the edge","of the world"]},r=a[this.killer]||a.natural;this.add.text(1280*.13,720*.78,r[0],{fontSize:"24px",fill:"#fff",fontFamily:"Arial"}),r[1]&&this.add.text(1280*.13,720*.83,r[1],{fontSize:"24px",fill:"#fff",fontFamily:"Arial"})}createLeafParticles(){this.leafParticles=[];for(let t=0;t<20;t++){const e=this.add.image(0,0,"particle_ecualyptusleaf");e.setVisible(!1).setScale(.5),this.leafParticles.push({sprite:e,vx:0,vy:0,alpha:1,active:!1})}}update(){switch(this.framesCounter++,this.endingState){case"DELAY":this.framesCounter>=10&&(this.endingState="SEASONS",this.framesCounter=0);break;case"SEASONS":if(this.seasons>0){const t=Math.min(this.framesCounter/90,1);this.seasonsCounter=Math.floor(this.seasons*t),this.clockRotation=this.initRotation-(this.finalRotation-this.initRotation)*t,this.seasonNeedle.setAngle(this.clockRotation),this.seasonsText.setText(String(this.seasonsCounter).padStart(3,"0")),this.framesCounter>=90&&(this.endingState="LEAVES",this.framesCounter=0)}else this.endingState="LEAVES";break;case"LEAVES":if(this.leavesCollected>0){if(this.framesCounter%4===0&&this.currentLeavesEnding<this.leavesCollected){this.currentLeavesEnding++,this.leavesText.setText(String(this.currentLeavesEnding).padStart(3,"0"));for(let t of this.leafParticles)if(!t.active){t.sprite.setPosition(1280*.46,720*.32).setVisible(!0),t.vx=Phaser.Math.Between(-5,5),t.vy=Phaser.Math.Between(-5,5),t.alpha=1,t.active=!0;break}}this.currentLeavesEnding>=this.leavesCollected&&(this.endingState="KILLS",this.framesCounter=0)}else this.endingState="KILLS";break;case"KILLS":if(this.killCount>0){const t=Math.min(this.framesCounter/90,1);this.currentScore=Math.floor(this.finalScore*t),this.scoreText.setText(String(this.currentScore).padStart(4,"0")),this.framesKillsCounter++,this.framesKillsCounter>=15&&this.activeKills.length<this.killHistory.length&&(this.showNextKillIcon(),this.framesKillsCounter=0),this.framesCounter>=90&&(this.endingState="REPLAY")}else this.endingState="REPLAY";break}for(let t of this.leafParticles)t.active&&(t.sprite.x+=t.vx,t.sprite.y+=t.vy,t.sprite.angle+=6,t.alpha-=.03,t.alpha<=0?(t.active=!1,t.sprite.setVisible(!1)):t.sprite.setAlpha(t.alpha))}showNextKillIcon(){const t=this.activeKills.length;if(t>=this.killHistory.length)return;const s=["","ending_plate_headsnake","ending_plate_headdingo","ending_plate_headowl","ending_plate_headbee","ending_plate_headeagle"][this.killHistory[t]];if(!s)return;const i=1280*.448+46*(t%10),a=720*.682+40*Math.floor(t/10),r=this.add.image(i,a,s).setOrigin(0,0);this.activeKills.push(r)}replay(){this.scene.start("GameScene")}}const P={type:A.AUTO,width:1280,height:720,parent:"game-container",backgroundColor:"#87CEEB",scale:{mode:A.Scale.FIT,autoCenter:A.Scale.CENTER_BOTH,width:1280,height:720},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[B,L,F]};new A.Game(P);
